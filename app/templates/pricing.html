<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'include.html' %}
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/pricing.css')}}"
    />
  </head>
  <body>
    {% include 'banner.html' %}
    <div class="section-header">
      <h2>Pricing Options</h2>
      <h4>Select a package</h4>
    </div>
    <div id="pricing-options"></div>

    <div class="section-header">
      <h2>Timeslot</h2>
    </div>

    <div class="calendar-all-wrapper">
      <div class="calendar-intersection-window"></div>
      <div id="calendar-grid-header">
        <div
          id="calendar-year-name"
          class="weekday"
          style="grid-area: 1 / 1"
        ></div>
        <div class="weekday" style="grid-area: 1 / 2">Sun</div>
        <div class="weekday" style="grid-area: 1 / 3">Mon</div>
        <div class="weekday" style="grid-area: 1 / 4">Tues</div>
        <div class="weekday" style="grid-area: 1 / 5">Wed</div>
        <div class="weekday" style="grid-area: 1 / 6">Thur</div>
        <div class="weekday" style="grid-area: 1 / 7">Fri</div>
        <div class="weekday" style="grid-area: 1 / 8">Sat</div>
      </div>
      <div id="calendar-scroll-container" class="calendar-grid-container">
        <div id="calendar-grid"></div>
      </div>
    </div>

    <h4>Select an approximate time</h4>

    <div id="timeslot-selector-wrapper" class="timeslot-selector-wrapper">
      <div id="morning-timeslot" class="timeslot-card" data-selectable="">
        Morning
      </div>
      <div id="afternoon-timeslot" class="timeslot-card" data-selectable="">
        Afternoon
      </div>
      <div id="evening-timeslot" class="timeslot-card" data-selectable="">
        Evening
      </div>
    </div>

    <div class="booking-info button-wrapper">
      <!-- Continue Booking button simply shows the modal -->
      <button id="continue-booking">Continue Booking</button>
    </div>

    <!-- Confirmation Modal (hidden by default) -->
    <div id="confirmation-modal" class="modal hidden">
      <div class="modal-content">
        <!-- Close button (Ã—) -->
        <span id="modal-close" class="close">&times;</span>
        <h3>Enter Your Details</h3>
        <form id="booking-form">
          <div class="form-group">
            <label for="first-name">First Name *</label>
            <input type="text" id="first-name" name="firstName" required />
          </div>
          <div class="form-group">
            <label for="last-name">Last Name *</label>
            <input type="text" id="last-name" name="lastName" required />
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required />
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" />
          </div>
          <!-- Error message placeholder -->
          <p id="error-message" class="hidden"></p>
          <!-- Confirm Booking button triggers the setupConfirmButton functionality -->
          <div class="button-wrapper" style="margin-bottom: 0;"><button style="width: 30%; min-width: 170px;" type="button" id="confirm-booking">Confirm Booking</button></div>
        </form>
      </div>
    </div>

    <!-- <div class="message-wrapper">
      <h3>Email for confirmation</h3>
      <input type="email" id="email-input" />
      <p style="max-width: 90%; text-align: center">
        Don't worry we'll work out specifics soon
      </p>
    </div>

    <div class="button-wrapper">
      <p id="error-message" class="hidden"></p>
      <button id="confirm-booking">Confirm booking</button>
    </div>

    <div id="confirmation-box-wrapper" class="confirmation-box-wrapper hidden">
      <div id="confirmation-box" class="modal">
        <div id="close-button"></div>
        <h3>Thanks for booking with us!</h3>
        <p>An email has been sent</p>
      </div>
    </div> -->

    {% include 'footer.html' %}
    <!-- <script>
      document.addEventListener("DOMContentLoaded", () => {
  // Elements for modal handling
  const continueBtn = document.getElementById("continue-booking");
  const modal = document.getElementById("confirmation-modal");
  const modalClose = document.getElementById("modal-close");

  // Show the modal when the Continue Booking button is clicked
  continueBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
  });

  // Hide the modal when the close button is clicked
  modalClose.addEventListener("click", () => {
    modal.classList.add("hidden");
  });

  // Set up Confirm Booking button functionality
  const confirmBtn = document.getElementById("confirm-booking");
  confirmBtn.addEventListener("click", async () => {
    // Collect the input fields from the modal form
    const firstName = document.getElementById("first-name").value.trim();
    const lastName  = document.getElementById("last-name").value.trim();
    const email     = document.getElementById("email").value.trim();
    const phone     = document.getElementById("phone").value.trim();

    // (You can extend your validation here if needed)
    if (!firstName || !lastName || !email) {
      document.getElementById("error-message").innerText = "Please fill in all required fields.";
      document.getElementById("error-message").classList.remove("hidden");
      return;
    } else {
      document.getElementById("error-message").classList.add("hidden");
    }

    // Call your existing functionality from setupConfirmButton here.
    // For instance, if you already have a function like:
    // async function setupConfirmButton(calendarAndDayDivs, timeslots) { ... }
    // You can call it here after collecting the additional form data.
    //
    // NOTE: You may need to update the code inside setupConfirmButton to also
    // retrieve firstName, lastName, and phone if they are required for your backend.
    //
    // For now, assuming that the rest of your booking functionality remains the same,
    // and that the email input is used for booking, we show the modal confirmation:
    
    // Example: prepare data for booking request (adjust this to match your logic)
    let data = {
      // ... include timeslot_id, status, pricing_id, etc.
      email: email,
      first_name: firstName,
      last_name: lastName,
      phone: phone // phone is optional
    };

    console.log("Booking data prepared:", data);
    
    // Here, you would perform the fetch request to your backend API as in your original code.
    // For demonstration, we just log the data and then hide the modal:
    try {
      // Assume your booking confirmation code goes here:
      // let response = await fetch('/api/update_timeslot_status', { ... });
      // if (!response.ok) throw new Error("Booking failed");
      // Otherwise, process the response, update UI, etc.
      console.log("Booking confirmed (simulate API call).");
      // After booking is confirmed, hide the modal:
      modal.classList.add("hidden");
    } catch (error) {
      console.error("Failed to confirm booking:", error);
    }
  });
});

    </script> -->
    <!-- <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Select DOM elements
        const confirmationBoxWrapper = document.getElementById(
          "confirmation-box-wrapper"
        );
        const closeButton = document.getElementById("close-button");
        confirmationBoxWrapper.addEventListener("click", () =>
          confirmationBoxWrapper.classList.toggle("hidden")
        );
        closeButton.addEventListener("click", () =>
          confirmationBoxWrapper.classList.toggle("hidden")
        );
      });
    </script> -->
    <script>
      fetch("/api/pricing")
        .then((response) => response.json())
        .then((data) => {
          const pricingContainer = document.getElementById("pricing-options");
          const cards = data.map((option) => {
            const optionDiv = document.createElement("div");
            optionDiv.classList.add("pricing-card");
            optionDiv.setAttribute("data-selectable", "");
            optionDiv.setAttribute("data-pricing-id", option.id);
            optionDiv.innerHTML = `
                        <h2 class="card-title">${option.name}</h2>
                        <p class="card-description">${option.description}</p>
                        <p class="card-holdPrice">Hold price: $${option.holdPrice.toFixed(
                          2
                        )}</p>
                        <p class="card-price">Price: $${option.price.toFixed(
                          2
                        )}</p>
                    `;
            pricingContainer.appendChild(optionDiv);
            return optionDiv;
          });
          cards.forEach((card) => {
            card.addEventListener("click", function () {
              if (card.classList.contains("selected")) {
                card.classList.remove("selected");
              } else {
                cards.forEach((c) => c.classList.remove("selected"));
                card.classList.add("selected");
              }
            });
          });
        })
        .catch((error) => console.error("Error fetching pricing data:", error));
    </script>

    <script src="{{ url_for('static', filename='js/booking.js') }}"></script>
  </body>
</html>
